KISSY.add("tml/share/model",function(f){function s(e){this.config(e)}var p=document.domain.indexOf(".net")>-1?"daily.taobao.net":"taobao.com",o={init:"http://tmallsns."+p+"/component/shareInit.do",copy:"http://tmallsns."+p+"/component/copyUrl.do",copyUrlInit:"http://tmallsns."+p+"/component/initUrl.do",share:"http://tmallsns."+p+"/component/shareItem.do",recCoupon:"http://tmallsns."+p+"/reward/GetShopRewardCoupon.do"},r=[{id:"4",name:"sina",zhName:"\u65b0\u6d6a\u5fae\u535a",bindUrl:"http://t."+p+
"/cooperate/connect/connect_sina.htm",freeShareTPL:"http://service.weibo.com/share/share.php?title={comment}&url={url}&pic={imgUrl}"},{id:"7",name:"qzone",zhName:"QQ\u7a7a\u95f4",bindUrl:"http://t."+p+"/cooperate/connect/connect_qzone.htm",freeShareTPL:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title={title}&url={url}&pics={imgUrl}&summary={comment}"},{id:"6",name:"qweibo",zhName:"\u817e\u8baf\u5fae\u535a",bindUrl:"http://t."+p+"/cooperate/connect/connect_qweibo.htm",freeShareTPL:"http://share.v.t.qq.com/index.php?c=share&a=index&title={comment}&url={url}&pic={imgUrl}"},
{id:"3",name:"renren",zhName:"\u4eba\u4eba\u7f51",bindUrl:"http://t."+p+"/cooperate/connect/connect_renren.htm",freeShareTPL:"http://widget.renren.com/dialog/share?resourceUrl={url}&srcUrl={url}&url={url}&title={title}&pic={imgUrl}&description={comment}"},{id:"2",name:"kaixin",zhName:"\u5f00\u5fc3\u7f51",bindUrl:"http://t."+p+"/cooperate/connect/connect_kaixin.htm",freeShareTPL:"http://www.kaixin001.com/rest/records.php?content={comment}&url={url}&pic={imgUrl}&style=11"},{id:"5",name:"sohu",zhName:"\u641c\u72d0\u5fae\u535a",
bindUrl:"http://t."+p+"/cooperate/connect/connect_sohu.htm",freeShareTPL:"http://t.sohu.com/third/post.jsp?title={comment}&content={comment}&url={url}&pic={imgUrl}"},{id:"0",name:"taobao",zhName:"\u6211\u7684\u6dd8\u5b9d",bindUrl:"",freeShareTPL:"http://share.jianghu.taobao.com/share/addShare.htm?title={comment}&url={url}&pic={imgUrl}"}];s.Config={type:3,id:0};f.augment(s,f.EventTarget,{config:function(e){return this.config=f.merge(s.Config,e)},loadInitData:function(e,j){var i=this;f.ajax({type:"get",
dataType:"jsonp",url:o.init,data:{type:i.config.type,actId:i.config.id,key:i.config.key},success:function(k){i.fire("initDataReturn",{data:k});e&&e.call(i,k)},timeout:3,error:function(k){i.fire("initDataError",{status:k});j&&j.call(i,k)}})},loadCopyData:function(e,j){var i=this;f.ajax({type:"get",dataType:"jsonp",url:o.copyUrlInit,data:{type:i.config.type,actId:i.config.id,key:i.config.key},success:function(k){e&&e(k)},timeout:3,error:function(k){j&&j.call(i,k)}})},recordCopy:function(){this.record(o.copy+
"?"+f.param({key:this.config.key,actId:this.config.id,type:this.config.type}))},share:function(e,j,i){var k=this;e=f.merge(k.config,e);e={_tb_token_:e.token||"",actId:e.id,type:e.type,key:e.key,title:encodeURIComponent(e.title||""),url:encodeURIComponent(e.url||""),content:encodeURIComponent(e.comment||""),imgUrl:e.imgUrl,fwd:e.fwd,signFlag:e.signFlag};k.fire("beforeShare",{shareData:e});f.ajax({type:"get",dataType:"jsonp",url:o.share,data:e,success:function(q){k.fire("afterShare",{result:q});j&&
j.call(k,q)},timeout:3,error:function(q){k.fire("shareError",{status:q});i&&i.call(k,q)}})},recCoupon:function(e,j){var i=this;f.ajax({type:"get",url:o.recCoupon,dataType:"jsonp",data:{actId:i.config.id,key:i.config.key,type:i.config.type},success:function(k){e&&e.call(i,k)},timeout:3,error:function(k){j&&j.call(i,k)}})},getAppList:function(){return r},getFreeShareUrl:function(e){e=f.merge(this.config,e);if(!this.getAppById(e.siteId))return"";var j=e.url||document.location.href;j+=(j.indexOf("?")>
-1?"&":"?")+"ali_trackid=21:zz_30774523_"+e.siteId+"_"+e.id;return this.substitute(this.getAppById(e.siteId).freeShareTPL,{title:encodeURIComponent(e.title||""),comment:encodeURIComponent(e.comment||""),url:encodeURIComponent(j),imgUrl:encodeURIComponent(e.picList?e.picList[0]:"")})},getFreeCopyUrl:function(){var e=this.config.url||document.location.href;e+=(e.indexOf("?")>-1?"&":"?")+"ali_trackid=21:zz_30774523_1_"+this.config.id;return e},getAppById:function(e){for(var j=0;j<r.length;j++)if(r[j].id==
e)return r[j]},record:function(e){if(e)(new Image).src=e},substitute:function(e,j,i){if(typeof e!="string"||!j)return e;var k=/\\?\{([^{}]+)\}/g;return e.replace(i||k,function(q,t){if(q.charAt(0)==="\\")return q.slice(1);return j[t]===undefined?"":j[t]})}});TML=TML||{};return TML.ShareModel=s});
KISSY.add("tml/share",function(f,s,p,o,r,e){function j(a){this.config=f.merge(j.Config,a);this.config.type=t[this.config.type];if(this.config.type!=undefined){this.isShareInit=this.isCopyInit=false;this._init()}}var i=f.DOM,k=p&&p.Dialog||TML.Overlay.Dialog;r=r||f.Template;s=s||TML.ShareModel;o=o||TML.MiniLogin;e=e||TML.ZeroClipboard;var q={shareTrigger:{full:'<div class="TMLShareTrigger" id="tml-share-trigger">   <div class="tml-share-ctn TMLShareCtn">       <em class="tml-share-copyIcon TMLShareCopy" title="\u590d\u5236\u94fe\u63a5\u5206\u4eab\u7ed9\u597d\u53cb">\u590d\u5236\u5206\u4eab</em>       <b class="tml-share-separator"></b>       {{#each appList as app}}           {{#if app.id != 0 }}           <a class="tml-share-app-t tml-share-app-{{app.name}}-t TMLShareAppT" title="\u5206\u4eab\u5230{{app.zhName}}" target="_blank" data-tml-appId="{{app.id}}" href="{{app.bindUrl}}"></a>           {{/if}}       {{/each}}   </div></div>',
mini:'<div class="TMLShareTrigger tml-share-mini" id="tml-share-trigger">   <div class="TMLShareHoverHandler tml-share-{{dir}}">       <div class="tml-share-title">\u5206\u4eab</div>       <div class="tml-share-hoverCon TMLShareHoverCon">           <div class="tml-share-ctn TMLShareCtn">           {{#if hasCopy }}               <em class="tml-share-copyIcon TMLShareCopy" title="\u590d\u5236\u94fe\u63a5\u5206\u4eab\u7ed9\u597d\u53cb">\u590d\u5236\u5206\u4eab</em>           {{/if}}           {{#each appList as app}}               {{#if app.id != 0 }}               <a class="tml-share-app-t tml-share-app-{{app.name}}-t TMLShareAppT" title="\u5206\u4eab\u5230{{app.zhName}}" target="_blank" data-tml-appId="{{app.id}}" href="{{app.bindUrl}}"></a>               {{/if}}           {{/each}}           </div>\t        <div class="tml-share-hoverTip"><b class="tml-share-hoverArrow"></b></div>       </div>   </div></div>',
fold:'<div class="TMLShareTrigger tml-share-short" id="tml-share-trigger">   <div class="tml-share-ctn tml-share-fold TMLShareCtn">       <em class="tml-share-copyIcon TMLShareCopy" title="\u590d\u5236\u94fe\u63a5\u5206\u4eab\u7ed9\u597d\u53cb">\u590d\u5236\u5206\u4eab</em>       <b class="tml-share-separator"></b>       <div class="tml-share-foldCon">       {{#each appList as app}}           {{#if app.id != 0 }}           <a class="tml-share-app-t tml-share-app-{{app.name}}-t TMLShareAppT" title="\u5206\u4eab\u5230{{app.zhName}}" target="_blank" data-tml-appId="{{app.id}}" href="{{app.bindUrl}}"></a>           {{/if}}       {{/each}}\t    </div>       <b class="tml-share-foldTrigger TMLShareFoldTrigger"></b>   </div></div>',
select:'<div class="TMLShareTrigger tml-share-select" id="tml-share-trigger">   <div class="tml-share-selectCon TMLShareSelectCon {{#if showShareTip}}tml-share-showShareTip{{/if}}">       <div class="tml-share-ctn TMLShareCtn">           {{#if showShareTip}}           <span class="tml-share-shareTip">\u5206\u4eab\u5230 : </span>           {{/if}}           {{#each appList as app}}               {{#if app.id != 0 }}               <a id="tml-share-app-s-con" class="TMLShareAppS {{#if bind[app.id]}} tml-share-app-s-selected {{/if}}" target="_blank" data-tml-appId="{{app.id}}" href="{{app.bindUrl}}" title="{{#if bind[app.id]}}\u70b9\u51fb\u53d6\u6d88{{#else}}\u9009\u4e2d\u5373{{/if}}\u5206\u4eab\u5230{{app.zhName}}">                   <span class="tml-share-app-s tml-share-app-{{app.name}}-s">                       <b class="tml-share-app-selectedIcon"></b>                   </span>               </a>               {{/if}}           {{/each}}           <span id="tml-share-app-s-con" class="tml-share-app-s-selected" data-tml-appId="0" title="\u9ed8\u8ba4\u5206\u4eab\u5230\u6211\u7684\u6dd8\u5b9d"><span class="tml-share-app-s tml-share-app-taobao-s"><b class="tml-share-app-selectedIcon"></b></span></span>       </div>   </div>   <b class="tml-share-selectTrigger TMLShareSelectTrigger"></b></div>'},
recTip:'<div class="tml-share-recTip TMLShareRecTip">  <b class="tml-share-recTipArrow"></b>  <p class="tml-share-recTipCtn">      <b class="tml-share-giftIcon"></b>      <em class="tml-share-recText">{{recText}}</em>      <b class="tml-share-recTipClose TMLShareRecTipClose">&times;</b>  </p></div>',msg:'<div class="tml-share-msg">  <div class="share-msg-con TMLShareMsgCon">       <p class="TMLShareMsgText"></p>       <s class="share-msg-icon"></s>       <b class="share-msg-close TMLShareMsgClose">&times;</b>  </div></div>',
shareDialog:'<div id="tml-share-dialog" data-tml-dialogId="{{dialogId}}">   <p class="tml-share-moodPic">   {{#if moodPicLink }}       <a href="{{moodPicLink}}" target="_blank"><img src="{{moodPic}}" width="235" height="50"/></a>   {{#else}}       <img src="{{moodPic}}" width="235" height="50"/>   {{/if}}   </p>   <p class="tml-share-comment">       <em class="tml-share-commentTip">{{commentTip}}<span class ="tml-share-commentCtnTip TMLShareCommentCtnTip">(\u55b5~~\u6700\u591a\u8f93\u5165100\u5b57\u54e6)</span></em>       <textarea class="tml-share-commentCtn TMLShareCommentCtn">{{comment}}</textarea>   </p>   {{#if picList&&picList.length>0}}   <div class="tml-share-picSelector TMLSharePicSelector">      <em class="tml-share-picSelectorTip">\u9009\u62e9\u642d\u914d\u56fe\uff1a</em>      <span class="tml-share-picSelectorSwitch {{#if picList.length<=4 }}hidden{{/if}}"">          <a class="tml-share-picSelectorPrev share-slide-arrow-mini" href="javascript:void(0);">&lt;</a>          <em class="tml-share-picCurrentPage TMLSharePicCurrentPage">1</em>/<em class="tml-share-picTotalPage">{{Math.ceil(picList.length/4)}}</em>          <a class="tml-share-picSelectorNext share-slide-arrow-mini" href="javascript:void(0);">&gt;</a>      </span>      <div class="tml-share-picSelectorScroller">          <ul class="tml-share-picSelectorContent">          {{#each picList as pic index}}               <li class="tml-share-picItemCon"><div class="tml-share-picItem {{#if index === 0 }} tml-share-pic-selected {{/if}} TMLSharePicItem" data-tml-pic="{{pic}}"><img src="{{pic}}_90x90.jpg" alt=""/><b class="tml-share-picSelectedIcon"></b></div></li>          {{/each}}           </ul>      </div>   </div>   {{/if }}<p class="tml-share-more">   <span class="tml-share-moreText">\u5206\u4eab\u5230</span>       {{#if currentApp}}           <a id="tml-share-app-s-con" class="tml-share-app-s-selected TMLShareAppS " title="\u70b9\u51fb\u53d6\u6d88\u5206\u4eab\u5230{{currentApp.zhName}}" target="_blank" data-tml-appId="{{currentApp.id}}" href="{{currentApp.bindUrl}}"><span class="tml-share-app-s tml-share-app-{{currentApp.name}}-s"><b class="tml-share-app-selectedIcon"></b></span></a>       {{/if}}       {{#each appList as app}}           {{#if  ( !currentApp || app.id != currentApp.id )&& app.id != 0 }}               <a id="tml-share-app-s-con" class="TMLShareAppS {{#if bind[app.id]}} tml-share-app-s-selected {{/if}}" target="_blank" data-tml-appId="{{app.id}}" href="{{app.bindUrl}}" title="{{#if bind[app.id]}}\u70b9\u51fb\u53d6\u6d88{{#else}}\u9009\u4e2d\u5373{{/if}}\u5206\u4eab\u5230{{app.zhName}}">                   <span class="tml-share-app-s tml-share-app-{{app.name}}-s">                       <b class="tml-share-app-selectedIcon"></b>                   </span>               </a>           {{/if}}       {{/each}}       <span id="tml-share-app-s-con" class="tml-share-app-s-selected" data-tml-appId="0" title="\u9ed8\u8ba4\u5206\u4eab\u5230\u6211\u7684\u6dd8\u5b9d"><span class="tml-share-app-s tml-share-app-taobao-s"><b class="tml-share-app-selectedIcon"></b></span></span>   </p>   <div class="tml-share-operate">     {{#if !signFlag}}     <p class="tml-share-agree" xmlns="http://www.w3.org/1999/html"><input type="checkbox" class="j_TMLShareAgreeCheckbox tml-share-agreeCheckbox" checked=checked/>\u6211\u540c\u610f<a class="tml-share-agreeLink" href="http://www.tmall.com/go/act/share/agree.php" target="_blank">\u300a\u7231\u5206\u4eab\u534f\u8bae\u300b</a></p>     {{/if}}     <button class="tml-share-button share-btn-l-primary TMLShareBtn" type="button">\u5206\u4eab</button>   </div></div>',
feedbackDialog:'<div id="tml-share-feedback" data-tml-dialogId="{{dialogId}}">  <div class="tml-share-feedbackCon {{#if !pic}}tml-share-feedbackNoPic{{/if}}">      {{#if !!pic}}      <img class="tml-share-feedbackPic" src="{{pic}}"/>      {{/if}}      <p class="tml-share-feedbackMsg">{{msg}}</p>      {{#if !!tip }}      <p class="tml-share-feedbackTip"><i class="tml-share-feedbackTipIcon"></i>{{tip}}</p>      {{/if}}      {{#if guide }}      <p class="tml-share-feedbackGuide">{{guide}}</p>      {{/if}}  </div>  <p class="tml-share-feedbackOperate"><button class="tml-share-feedbackOKbtn share-btn-l TMLFeedbackOKBtn" type="button">\u786e\u5b9a</button></p></div>'},
t={item:0,shop:1,act:2,other:3};j.Config={id:"0",type:"other",key:"",style:"full",comment:"",picTip:"\u9009\u62e9\u642d\u914d\u56fe",title:"",dialogTitle:"\u7231\u5206\u4eab , \u5206\u4eab\u7231",url:"",showRecTip:true,recText:'\u5206\u4eab\u8d62\u5927\u5956 \u70b9\u51fb<a href="http://fenxiang.tmall.com/1111" target="_blank">\u67e5\u770b\u8be6\u60c5</a>',dir:"right",hasCopy:true,copySucText:"\u590d\u5236\u6210\u529f\uff01\u53d1\u7ed9QQ/\u65fa\u65fa\u597d\u53cb",showTB:true,bindByWindow:false,showShareTip:false,
showMsg:true,mask:false,free:false};f.augment(j,f.EventTarget,{_init:function(){this._bindModel();this._render();this._bindEvent()},_bindModel:function(){this.model=new s(this.config)},_render:function(){var a=this;if(a.config.container){a.container=f.one(a.config.container);if(a.container){var b=q.shareTrigger[a.config.style=="short"?"fold":a.config.style];if(b)if(a.config.style=="select")a._loadInitData(function(c){if(!c.success&&c.errcode===0)o.show({check:false,needRedirect:true});else{a.container.html(r(b).render({appList:a.getAppList(),
bind:c.bind||[],showShareTip:a.config.showShareTip}));a.shareTrigger=a.container.one(".TMLShareTrigger");a._bindShareAppS(a.shareTrigger);a._bindShareStretch()}});else{a.container.html(r(b).render({appList:a.getAppList(),dir:a.config.dir=="left"?"left":"right",hasCopy:a.config.hasCopy}));a.shareTrigger=a.container.one(".TMLShareTrigger");if(a.shareTrigger)if(a.config.showRecTip){a.recTipOverlay=f.Node(r(q.recTip).render({recText:a.config.recText}));a.recTipOverlay.appendTo(a.shareTrigger);a.config.style!=
"mini"&&a.shareTrigger.css({height:"38px"});a.delegate(a.recTipOverlay,"click",".TMLShareRecTipClose",function(){a.recTipOverlay.fadeOut(0.5);a.shareTrigger.css({height:"auto"})})}}}}},_bindEvent:function(){this._bindInitEvent();this._bindShareFold();this._bindShareHover();this._bindShareCopy();this._bindShareAppT()},_bindInitEvent:function(){var a=this;!a.shareTrigger||a.config.free||a.shareTrigger.all(".TMLShareCtn").on("mouseenter",function(b){f.one(b.target);a._loadInitData()})},_loadInitData:function(a){var b=
this;b.model.loadInitData(function(c){if(c)if(c.success||c.errcode===0){b.initData=f.merge(b.initData,c);a&&a.call(b,c);b.isShareInit=true}else f.log("share component init  error!")})},_loadCopyData:function(a){var b=this;b.isCopyInit||b.model.loadCopyData(function(c){if(c)if(c.success||c.errcode===0){b.initData=f.merge(b.initData,c);a&&a.call(b,c);b.isCopyInit=true}else f.log("share copy init  error!")})},_bindShareStretch:function(){var a=this;if(a.shareTrigger){var b=a.config.showTB?185:155;if(a.config.showShareTip)b+=
47;if(!a.config.showTB&&f.UA.ie==7)b-=3;a.delegate(a.shareTrigger,"click",".TMLShareSelectTrigger",function(){f.Anim(a.shareTrigger.one(".TMLShareSelectCon"),{width:b+"px"},0.3,"easeNone",function(){a.shareTrigger.one(".TMLShareSelectTrigger").hide()}).run()})}},_bindShareHover:function(){var a=this;if(!(!a.shareTrigger||a.config.style!=="mini")){var b=a.shareTrigger.one(".TMLShareHoverHandler"),c=a.shareTrigger.one(".TMLShareHoverCon"),d=a.config.hasCopy?152:132;b.on("mouseenter",function(){a.isInHoverCon=
true;c.addClass("tml-share-hover");a.hoverAnim&&a.hoverAnim.stop();a.hoverAnim=f.Anim(c,{width:d+"px"},0.3,"easeNone",function(){a.clip&&a.clip.reposition()});a.hoverAnim.run()});b.on("mouseleave",function(g){a.isInHoverCon=false;if(!a._isInArea(c,g.pageX,g.pageY)){c.removeClass("tml-share-hover");a.hoverAnim&&a.hoverAnim.stop();a.hoverAnim=f.Anim(c,{width:"0px"},0.3,"easeNone",function(){a.clip&&a.clip.hide()});a.hoverAnim.run()}})}},_bindShareFold:function(){var a=this;if(!(!a.shareTrigger||a.config.style!==
"short")){a.delegate(a.shareTrigger,"click",".TMLShareFoldTrigger",function(b){b.halt();a.recTipOverlay&&a.recTipOverlay.fadeOut(0.3);a.shareTrigger.css({height:"auto"});a.msgOverlay&&a.msgOverlay.hide();a.shareTrigger.one(".TMLShareCtn").toggleClass("tml-share-fold tml-share-unfold")});a.delegate(a.shareTrigger,"selectstart",".TMLShareFoldTrigger",function(b){b.halt()})}},_bindShareCopy:function(){var a=this;if(a.shareTrigger){var b=a.shareTrigger.one(".TMLShareCopy");if(b){a.clip=new e.Client;a.clip.glue(b.getDOMNode());
a.clip.setHandCursor(true);var c=f.one(a.clip.div);c.attr("title","\u590d\u5236\u94fe\u63a5\u5206\u4eab\u7ed9\u597d\u53cb");c.css({"font-size":"0","line-height":"0"});a.clip.hide();b.on("mouseenter",function(){a.config.style!="mini"&&a.clip.reposition()});a.clip.addEventListener("onmouseover",function(){a.config.free||a._loadCopyData()});if(a.config.style=="mini"){var d=a.shareTrigger.one(".TMLShareHoverCon");a.clip.addEventListener("onmouseout",function(){f.later(function(){if(!a.isInHoverCon){d.removeClass("tml-share-hover");
a.clip.hide();a.hoverAnim&&a.hoverAnim.stop();a.hoverAnim=f.Anim(d,{width:"0px"},0.3,"easeNone",function(){a.clip.hide()});a.hoverAnim.run()}},5)})}a.clip.addEventListener("onmousedown",function(){if(a.config.free)a.clip.setText(a.model.getFreeCopyUrl());else if(a.initData){a.clip.setText(a.config.url||a.initData.url||document.location.href);a.recTipOverlay&&a.recTipOverlay.fadeOut(0.3);a.model.recordCopy()}});a.clip.addEventListener("oncomplete",function(){if(a.config.free)a.recTipOverlay&&a.recTipOverlay.fadeOut(0.3);
else{if(!a.initData){a.recTipOverlay&&a.recTipOverlay.fadeOut(0.3);a._showMsg("attention","\u55b5~\u6b63\u5728\u521d\u59cb\u5316\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01");return}if(a.initData.errcode===0){o.show({check:false,needRedirect:true});return}}a._showMsg("ok",a.config.copySucText)})}}},_bindShareAppT:function(){var a=this;a.shareTrigger&&a.delegate(a.shareTrigger,"click",".TMLShareAppT",function(b){a.recTipOverlay&&a.recTipOverlay.fadeOut(0.3);a.msgOverlay&&a.msgOverlay.hide();var c=i.attr(b.currentTarget,
"data-tml-appId");if(a.config.free){b.halt();window.open(a.model.getFreeShareUrl({siteId:c}))}else if(a.initData)if(!a.initData.success&&a.initData.errcode===0){o.show({check:false,needRedirect:true});b.halt()}else{a.initData.bind[c]&&b.halt();a.popup(c)}else{a._showMsg("attention","\u55b5~\u6b63\u5728\u521d\u59cb\u5316\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01");b.halt()}})},mergeConfig:function(a){return this.config=f.merge(this.config,a)},popup:function(a){var b=f.makeArray(arguments),c=arguments.callee,
d=this;if(d.initData)if(!d.initData.success&&d.initData.errcode===0)o.show({check:false,needRedirect:true});else{var g=r(q.shareDialog).render({dialogId:f.guid(),currentApp:d.getAppById(a),commentTip:d.config.commentTip||d.initData.tipsText||"\u548c\u670b\u53cb\u4eec\u8bf4\u70b9\u4ec0\u4e48",comment:d.config.comment||d.initData.content,picList:d.config.picList||d.initData.imgs,appList:d.getAppList(),moodPic:d.config.moodPic||d.initData.tipsImg||"http://img02.taobaocdn.com/tps/i2/T1542JXXXhXXXRFozp-235-50.jpg",
moodPicLink:d.config.moodPicLink||d.initData.bannerUrl,signFlag:d.initData.signFlag,bind:d.initData.bind||[]});if(d.shareDialog)d.shareDialog.set("bodyContent",g);else{d.shareDialog=new k({width:490,elCls:d.config.dialogCls,headerContent:d.config.dialogTitle,bodyContent:g,skin:"default",mask:d.config.mask,align:{points:["cc","cc"]},zIndex:999998});d.shareDialog.render();g=d.shareDialog.get("el");if(!(f.UA.ie<7)){g.css("position","fixed");g.css("top",(i.viewportHeight()-g.height())/2)}d._bindShareAppS(g);
d._bindCheckComment();d._bindPicSelector();d._bindShare()}d._initPicCarousel();d.fire("beforeShareDialogShow",{initData:d.initData,shareDialog:d.shareDialog});d.shareDialog.show()}else d._loadInitData(function(){c.apply(d,b)})},_initPicCarousel:function(){if(this.shareDialog){var a=this.shareDialog.get("el"),b=a.one(".TMLSharePicSelector");if(b){f.use("switchable",function(){(new (f.Carousel||f.Switchable.Carousel)(b,{effect:"scrollx",easing:"easeOutStrong",steps:4,viewSize:[464],interval:5,switchTo:0,
circular:false,contentCls:"tml-share-picSelectorContent",prevBtnCls:"tml-share-picSelectorPrev",nextBtnCls:"tml-share-picSelectorNext",hasTriggers:false})).on("beforeSwitch",function(c){a.one(".TMLSharePicCurrentPage").html(c.toIndex+1)})});a.data("data-tml-selectedPicItem",a.one(".TMLSharePicItem"))}}},_bindCheckComment:function(){var a=this;if(a.shareDialog){var b=a.shareDialog.get("el");a.delegate(b,"focusin",".TMLShareCommentCtn",function(){b.one(".TMLShareCommentCtnTip").show()});a.delegate(b,
"keyup",".TMLShareCommentCtn",function(){var c=f.trim(b.one(".TMLShareCommentCtn").val());c=a._checkLength(c,100);var d="";d=c.overflow?'(\u55b5~\u5df2\u7ecf\u8d85\u51fa<i class="tml-share-warnNum">'+c.overflowNum+"</i>\u5b57\u55bd)":"(\u55b5~~\u6700\u591a\u8f93\u5165100\u5b57\u54e6)";b.one(".TMLShareCommentCtnTip").html(d)})}},_bindPicSelector:function(){if(this.shareDialog){var a=this.shareDialog.get("el");this.delegate(a,"click",".TMLSharePicItem",function(b){b=f.Node(b.currentTarget);var c=a.data("data-tml-selectedPicItem");
c&&c.removeClass("tml-share-pic-selected");b.addClass("tml-share-pic-selected");a.data("data-tml-selectedPicItem",b)})}},_bindShareAppS:function(a){var b=this;a&&b.delegate(a,"click",".TMLShareAppS",function(c){if(b.initData)if(!b.initData.success&&b.initData.errcode===0){o.show({check:false,needRedirect:true});c.halt()}else{var d=f.Node(c.currentTarget),g=d.attr("data-tml-appId"),h=b.getAppById(g).zhName;if(d.hasClass("tml-share-app-s-selected"))d.getDOMNode().title="\u9009\u4e2d\u5373\u5206\u4eab\u5230"+
h;else d.getDOMNode().title="\u70b9\u51fb\u53d6\u6d88\u5206\u4eab\u5230"+h;if(b.config.bindByWindow){c.halt();if(!b.initData.bind[g]&&!d.hasClass("tml-share-app-s-selected")){c=d.attr("href");b.openWindow(c)}}else if(b.initData.bind[g]||d.hasClass("tml-share-app-s-selected"))c.halt();d.toggleClass("tml-share-app-s-selected")}})},_bindShare:function(){function a(){var h=g.data("data-tml-selectedPicItem");if(h=h||g.one(".TMLSharePicItem"))return h.attr("data-tml-pic");return""}function b(){var h="0";
g.all(".TMLShareAppS").each(function(l){if(l.hasClass("tml-share-app-s-selected"))h+=","+l.attr("data-tml-appId")});return h}function c(){var h=g.one(".j_TMLShareAgreeCheckbox");return h?h.getDOMNode().checked?1:0:0}var d=this;if(d.shareDialog){var g=d.shareDialog.get("el");d.delegate(g,"click",".TMLShareBtn",function(){var h=f.trim(g.one(".TMLShareCommentCtn").val())||d.config.comment;if(d._checkLength(h,100).overflow)d._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u6700\u591a\u8f93\u5165100\u4e2a\u5b57\uff01"});
else{h={token:d.initData.token||"",id:d.config.id,type:d.config.type,key:d.config.key,title:d.config.title,url:d.config.url,comment:h,imgUrl:a(),fwd:b(),signFlag:c()};f.log(h);d.share(h,d.recCouponHandler,function(){d._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5206\u4eab\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"})})}})}},_popupFeedbackDialog:function(a,b){var c=this;a=r(q.feedbackDialog).render({dialogId:f.guid(),pic:{suc:"http://img04.taobaocdn.com/tps/i4/T1uAEZXfdeXXbJqPYj-60-50.png",
fail:"http://img03.taobaocdn.com/tps/i3/T1l7gZXeFcXXbJqPYj-60-50.png"}[a.picType],msg:a.msg,tip:a.tip,guide:a.guide});if(c.feedbackDialog)c.feedbackDialog.set("bodyContent",a);else{c.feedbackDialog=new k({width:490,elCls:c.config.dialogCls,headerContent:c.config.dialogTitle,bodyContent:a,mask:c.config.mask,showCat:false,skin:"default",align:{points:["cc","cc"]},zIndex:999999});c.feedbackDialog.render();a=c.feedbackDialog.get("el");if(!(f.UA.ie<7)){a.css("position","fixed");a.css("top",(i.viewportHeight()-
a.height())/2)}c.delegate(c.feedbackDialog.get("el"),"click",".TMLFeedbackOKBtn",function(){c.feedbackDialog.hide()})}b&&c.fire("afterShare",{shareResult:b,feedbackDialog:c.feedbackDialog});c.feedbackDialog.show()},_showMsg:function(a,b){var c=this;if(c.config.showMsg){if(!c.msgOverlay){c.msgOverlay=f.Node(q.msg);c.msgOverlay.appendTo(c.shareTrigger);c.config.style=="mini"&&c.config.dir=="left"&&c.msgOverlay.css("left","-163px");c.msgOverlay.one(".TMLShareMsgClose").on("click",function(){c.msgOverlay.hide()})}c.msgOverlay.one(".TMLShareMsgText").html(b);
c.msgOverlay.one(".TMLShareMsgCon").removeClass("share-msg-ok share-msg-attention").addClass("share-msg-"+a);c.msgOverlay.show();c.timer&&c.timer.cancel();c.timer=f.later(function(){c.msgOverlay.hide();c.timer.cancel()},1500)}},_isInArea:function(a,b,c){if(f.UA.ie<7)c+=2;a=f.one(a);if(!a)return false;var d=a.offset();f.log("x:"+b+" left:"+d.left+" right:"+(d.left+a.width()));f.log("y:"+c+" top:"+d.top+" bottom:"+(d.top+a.height()));return b>d.left&&b<d.left+a.width()&&c>d.top&&c<d.top+a.height()},
_checkLength:function(a,b){a=a.length;return{overflow:a>b,overflowNum:a-b}},getSelectedFwd:function(){var a=["0"];if(this.config.style!="select"||!this.shareTrigger)return a;this.shareTrigger.all(".TMLShareAppS").each(function(b){b.hasClass("tml-share-app-s-selected")&&a.push(b.attr("data-tml-appId"))});return a},share:function(a,b,c){var d=this;d.model.share(a,function(g){b&&b.call(d,g)},function(g){c&&c.call(d,g)})},defaultShareHandler:function(a){if(a){this.shareDialog&&this.shareDialog.hide();
if(a.success){var b=true,c=true,d=true,g="",h="";for(var l in a.shareResult){if(a.shareResult[l]===1){g+="\u3001"+(this.getAppById(l)?this.getAppById(l).zhName:"");d=false}if(a.shareResult[l]!==1){h+="\u3001"+(this.getAppById(l)?this.getAppById(l).zhName:"");b=false}if(a.shareResult[l]!==7)c=false}g=g.substring(1);if(h)h=h.substring(1);if(b)this._popupFeedbackDialog({picType:"suc",msg:this.initData.isTKItem?"\u5206\u4eab\u6210\u529f\uff01\u548c\u670b\u53cb\u5206\u4eab\u66f4\u591a\u5b9d\u8d1d\uff0c\u4f60\u548cTa\u90fd\u80fd\u62ff\u5230\u793c\u54c1\uff01":
"\u5206\u4eab\u6210\u529f\uff01\u548c\u670b\u53cb\u5206\u4eab\u597d\u5b9d\u8d1d\uff0c\u8bf4\u4e0d\u5b9aTa\u4e5f\u559c\u6b22\uff01"},a);else if(c)this._popupFeedbackDialog({picType:"fail",msg:"\u5206\u4eab\u6ca1\u6210\u529f\uff0c\u5148\u786e\u8ba4\u4e00\u4e0b\u662f\u5426\u5df2\u7ed1\u5b9a\uff01"},a);else d?this._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5206\u4eab\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"},a):this._popupFeedbackDialog({msg:"\u6210\u529f\u5206\u4eab\u5230"+
g,tip:h+"\u5206\u4eab\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u7ed1\u5b9a\u6210\u529f\u54e6~"},a)}else switch(a.errcode){case 0:o.show({check:false,needRedirect:true});break;case 12:this._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5185\u5bb9\u5b8c\u5168\u76f8\u540c\u53ef\u4e0d\u884c\u5662\uff0c\u53bb\u4fee\u6539\u4e0b\u5185\u5bb9\u5427~"},a);break;default:this._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5206\u4eab\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"},
a)}}},recCouponHandler:function(a){var b=this;if(a){b.shareDialog&&b.shareDialog.hide();if(a.success){var c=true,d=true,g=false,h="",l="";for(var n in a.shareResult){if(a.shareResult[n]===1){h+="\u3001"+(b.getAppById(n)?b.getAppById(n).zhName:"");d=false}if(a.shareResult[n]!==1){l+="\u3001"+(b.getAppById(n)?b.getAppById(n).zhName:"");c=false}if(n!=="0"&&a.shareResult[n]===1)g=true}h=h.substring(1);l=l.substring(1);if(d)b._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5206\u4eab\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"},
a);else g?b.model.recCoupon(function(m){if(!m||!m.success||!m.list||m.list.length<1)b._popupFeedbackDialog({picType:"suc",msg:"\u6210\u529f\u5206\u4eab\u5230"+h,tip:c?"":l+"\u5206\u4eab\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u7ed1\u5b9a\u6210\u529f\u54e6~"},a);else{m=m.list[0];var u="\u6ee1"+m.startFee/100+"\u5143\u53ef\u4f7f\u7528\u7684";if(m.startFee-m.value===1)u="\u65e0\u4f7f\u7528\u6761\u4ef6\u7684";b._popupFeedbackDialog({picType:"suc",msg:"\u6210\u529f\u5206\u4eab!\u606d\u559c\u60a8\u83b7\u5f97"+
m.name+"\u8d60\u9001\u7684"+u+'<em class="red">'+m.value/100+'</em>\u5143\u4f18\u60e0\u5238\uff0c<a href="'+m.url+'" target="_blank">\u7acb\u5373\u9886\u53d6</a>',guide:m.shopUrl?'<a href="'+m.shopUrl+'" target="_blank">\u53bb\u901b\u901b\u5e97\u94fa>></a>':""},a)}},function(){b._popupFeedbackDialog({picType:"suc",msg:"\u6210\u529f\u5206\u4eab\u5230"+h,tip:c?"":l+"\u5206\u4eab\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u7ed1\u5b9a\u6210\u529f\u54e6~"},a)}):b._popupFeedbackDialog({picType:"suc",
msg:"\u6210\u529f\u5206\u4eab\u5230"+h,tip:c?"":l+"\u5206\u4eab\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u7ed1\u5b9a\u6210\u529f\u54e6~"},a)}else switch(a.errcode){case 0:o.show({check:false,needRedirect:true});break;case 12:b._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5185\u5bb9\u5b8c\u5168\u76f8\u540c\u53ef\u4e0d\u884c\u5662\uff0c\u53bb\u4fee\u6539\u4e0b\u5185\u5bb9\u5427~"},a);break;case 14:b._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5206\u4eab\u8fc7\u4e8e\u9891\u7e41\u54e6\uff0c\u8bf7\u7a0d\u4f5c\u4f11\u606f\u4f1a~"},
a);break;default:b._popupFeedbackDialog({picType:"fail",msg:"\u55b5~\u5206\u4eab\u6ca1\u6210\u529f\uff01\u5206\u4eab\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"},a)}}},getAppList:function(){if(this.model)return this.model.getAppList()},getAppById:function(a){if(this.model)return this.model.getAppById(a)},delegate:function(a,b,c,d,g){function h(l,n){var m=n.substring(1);if(n.charAt(0)==="#")return i.attr(l,"id")===m;else if(n.charAt(0)===".")return i.hasClass(l,m);return false}
if(!(!a||!b||!c||!d))(a=f.one(a))&&a.on(b,function(l){var n=l.target,m=i.parent(n,function(u){return h(u,c)});if(m||h(n,c)){l.currentTarget=f.one(m||n);d.call(g||window,l)}})},openWindow:function(a,b,c){var d=(window.screen.width-800)/2,g=(window.screen.height-630)/2;window.open(a,b,c||"width=800px,height=630px,screenX="+d+"px,screenY="+g+"px,status=no,toolbar=no,menubar=no,location=no,scrollbars=no")},log:function(){f.each(arguments,function(a){f.log(a)})}});TML=TML||{};return TML.Share=j},{requires:["tml/share/model",
"tml/overlay","tml/minilogin","template","tml/zeroclipboard","tml/overlay/css/overlay.css","tml/share/css/share.css"]});