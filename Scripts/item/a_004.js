KISSY.add("wangpu/base",function(e,h,c){var g=document,f=e.DOM,b=e.Event;function d(j){var i=this;i._mod=j.mod;i._context=j;if(!i._mod){return}i._init()}e.augment(d,{_init:function(){e.log("Base init start");var j=this,i=j._context.pageType;j._changeDomain();j._updateToken();if(i!="cdetail"){j._initCollectDialog()}e.log("Base init end")},_changeDomain:function(){try{var j=document.domain.split(".");document.domain=j.slice(j.length-2).join(".")}catch(i){}},_updateToken:function(){var k=f.get("#J_TokenField");if(!k){return}var l=/_tb_token_=[^&]*/i,i=f.query("a.J_TokenSign",g),j="_tb_token_="+k.value;e.each(i,function(n){var m=n.href;if(l.test(m)){n.href=m.replace(l,j)}else{n.href+=(m.lastIndexOf("&")!==-1?"&":"?")+j}})},_initCollectDialog:function(){var i,j=location.hostname.indexOf("tmall.com")!==-1||location.hostname.indexOf("tmall.net")!==-1;i=f.create('<div id="popupPanel">');g.body.appendChild(i);e.each(f.query(".J_TDialogTrigger"),function(l){var n=l.getAttribute("data-width"),k=l.getAttribute("data-height"),m=new c.Dialog({srcNode:i,width:n,height:k,closable:false,elStyle:{display:"block",visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px"}});b.on(l,"click",function(o){o.preventDefault();m.hide();f.show(i);m.show()});m.on("show",function(){var p=this,o=a(l.href)+(j?"&isTmall=1":""),q='<a class="close-btn" href="javascript:void(0)"style="position: absolute; top: 5px; right: 4px; outline: none;display: block; width: 15px; height: 15px; background: url(http://a.tbcdn.cn/app/tc/img/close_btn.png) no-repeat; text-decoration: none; text-indent: -99999px">X</a><iframe src="'+o+'" width="'+n+'" height="'+k+'" name="popupIframe" frameborder="0" scrolling="no"></iframe>';p.set("width",n);p.set("height",k);f.html(i,q);m.center();b.on(f.get(".close-btn",i),"click",function(){m.hide()});if(f.hasClass(l,"collection")&&window.g_config.type=="b"){(new Image).src="http://www.atpanel.com/jsclick?cache="+ +new Date+"&auc_detail=b_collect_item"}f.removeClass("#shop-info","expanded")})})}});function a(j){var i=e.now();return j+(j.indexOf("?")===-1?"?":"&")+"t="+i}d.selector="body";d.type="base";return d},{requires:["core","overlay"]});KISSY.add("wangpu/mods/official/page-banner",function(d,f,b){var e=d.DOM,a=d.Event;function c(h){var g=this;g._mod=h.mod;if(!g._mod){return}g._init()}d.augment(c,{_init:function(){d.log("PageBanner init start");var g=this;g._initCatsPopup();d.log("PageBanner init end")},_initCatsPopup:function(){var g=e.get("#J_HeadCatsPopup");if(g){new b.Popup({srcNode:e.get("#content").appendChild(g),trigger:"#J_HeadCats",triggerType:"mouse",delay:0.2,elStyle:{display:"block",visibility:"hidden"},align:{node:"#J_HeadCats",points:["bc","tl"],offset:[-47,4]}})}}});c.selector=".tshop-pbsm-spb10c";return c},{requires:["core","overlay"]});KISSY.add("wangpu/mods/official/shopinsearch-head",function(c,f){var e=document,d=c.DOM,a=c.Event;function b(h){var g=this;g._mod=h.mod;if(!g._mod){return}g._init()}c.augment(b,{_init:function(){c.log("ShopinsearchHead init start");this._inputHint("#J_ShopSKey");c.log("ShopinsearchHead init end")},_inputHint:function(j){j=d.get(j);if(!j){return}var i=j.parentNode,g="focus",h=function(){""!==j.value?d.addClass(i,g):d.removeClass(i,g)};a.on(j,g,function(k){d.addClass(i,g)});a.on(j,"blur",h);setTimeout(h,0)}});b.selector=".tshop-pbsm-ssish10c";return b},{requires:["core"]});KISSY.add("wangpu/mods/official/customer-service",function(S,Core){var DOM=S.DOM;function CustomerService(context){var self=this;self._mod=context.mod;if(!self._mod){return}self._init()}S.augment(CustomerService,{_init:function(){S.log("CustomerService init start");var self=this;self._displayWWGroop();S.log("CustomerService init end")},_displayWWGroop:function(){var self=this,tempwangwang,templi,tempdesc,api="http://amos.im.alisoft.com/",config="v=2&site=cntaobao&s=1&charset=utf-8&uid=",uls=S.all("ul.service-group",self._mod),node=uls.item(uls.length-1),url=node.attr("data-url"),nick=node.attr("data-nick"),gnick=node.attr("data-gnick"),groupIdFilter=node.attr("data-group-filter").split("\u03b1_\u03a9-\u03c0");node.children().innerHTML=null;S.getScript(url,function(){var group=groupMember&&eval("("+groupMember+")").groups||"";if(""!=group&&""!=groupIdFilter[0]){var groupMembers=eval("("+groupMember+")").groups.group;S.each(groupMembers,function(item,temp){if(S.inArray(groupMembers[temp].groupId.toString(),groupIdFilter)||groupIdFilter[0]=="all"){templi=DOM.create("<li>"),tempdesc=DOM.create("<span>",{"class":"groupname"});DOM.html(tempdesc,groupMembers[temp].groupName);tempwangwang=DOM.create("<a>",{href:api+"getcid.aw?v=3&uid="+gnick+"&site=cntaobao&groupid="+groupMembers[temp].groupId+"&s=1&charset=gbk&fromid=cntaobao"+S.Cookie.get("_nk_"),target:"_blank"});tempwangwang.appendChild(DOM.create("<img>",{src:api+"grponline.aw?v=3&uid="+gnick+"&site=cntaobao&gids="+groupMembers[temp].groupId+"&s=1",alt:"\u70b9\u51fb\u8fd9\u91cc\u7ed9\u6211\u53d1\u6d88\u606f"}));templi.appendChild(tempdesc);DOM.insertAfter(tempwangwang,tempdesc);node.append(templi)}})}else{templi=DOM.create("<li>",{"data-wangwang":"mainwangwang"}),tempdesc=DOM.create("<span>",{"class":"groupname"});DOM.html(tempdesc,"\u5ba2\u670d\u4e2d\u5fc3");tempwangwang=DOM.create("<a>",{href:api+"msg.aw?"+config+nick,target:"_blank"});tempwangwang.appendChild(DOM.create("<img>",{src:api+"online.aw?"+config+nick,alt:"\u70b9\u51fb\u8fd9\u91cc\u7ed9\u6211\u53d1\u6d88\u606f"}));templi.appendChild(tempdesc);DOM.insertAfter(tempwangwang,tempdesc);node.append(templi)}})}});CustomerService.selector="#customer-box";return CustomerService},{requires:["core","cookie"]});KISSY.add("wangpu/mods/official/top-list",function(S,Core,Switchable,Overlay,Node){var doc=document,DOM=S.DOM,Event=S.Event;function TopList(context){var self=this;self._mod=context.mod;if(!self._mod){return}self._init()}S.augment(TopList,{_init:function(){S.log("TopList init start");var self=this;self._initTab();self._initPopup();S.log("TopList init end")},_initTab:function(){var dataEl,self=this,triggers,panels,val,activeIndex=0,tabs;if(DOM.get("ul.tab-nav",self._mod)==null){return}var noPicUrl="http://img.taobao.com/newshop/nopicture.gif",markup='<li><div class="pic"><a target="_blank" href="#href#"><img width="40px" bigpicurl="#bigpic#" src="#src#"></a></div><div class="desc"><a target="_blank" title="#title#" href="#href#">#title#</a></div><div class="price"><i></i>#price#</div><div class="collecter"><i></i>\u6536\u85cf\u4eba\u6c14&nbsp;&nbsp;#colcount#</div></li>',pic_suffix="_40x40.jpg",big_pic_suffix="_120x120.jpg",rankpanel2=DOM.query(".J_TopColl");var conf=DOM.get("#J_dcTopListData"),val=DOM.attr(conf,"data-value");if(conf&&val){val=eval("("+val+")")}if(!val){return}if(val.list==="topCollect"){activeIndex=1}else{activeIndex=0}triggers=DOM.query("li",DOM.get("ul.tab-nav",self._mod));panels=DOM.query("div.rank-panel",self._mod);var tabs_cfg={triggers:triggers,panels:panels,delay:0.5,activeTriggerCls:"selected"};if(triggers.length===0){tabs_cfg.hasTriggers=false}tabs=new Switchable.Tabs(DOM.get("div.rank-tab",self._mod),tabs_cfg);tabs.on("switch",function(ev){var tg=ev.target,index=ev.currentIndex,curr=DOM.get(".J_TopColl",tg.content),rindex=-1;if(index==1&&DOM.attr(curr,"init-data")!="true"){window.shop=window.shop||{};S.query("div.J_TopColl").each(function(v,k){if(curr==v){rindex=k}});S.getScript(DOM.attr(curr,"data-url")+"&jsoncallback=window.shop.rankCallback&index="+rindex);window.shop.rankCallback=function(data){var result="",spm=DOM.attr(DOM.parent("#J_ranktab",3),"data-spm");spm=spm&&spm.substring(0,3)=="110"?spm:"";if(data&&data.items){S.each(data.items,function(v,k){result+=markup.replace(/#href#/g,v.link+(spm!=""?"&spm="+spm:"")).replace(/#bigpic#/g,v.imageUrl+big_pic_suffix).replace(/#src#/g,v.imageUrl+pic_suffix).replace(/#title#/g,v.title).replace(/#price#/g,v.price).replace(/#colcount#/g,v.collectorCount)});DOM.html(DOM.get("ul",rankpanel2[data.index||0]),result);DOM.attr(rankpanel2[data.index||0],"init-data","true");result=""}}}});tabs.switchTo(activeIndex)},_initPopup:function(){var self=this,popup;popup=new Overlay.Popup({triggerType:"mouse"});var rankPanels=DOM.get(".rank-panels",self._mod),$=Node.all;Event.delegate(rankPanels,"mouseenter","div.pic",function(e){var t=$(e.currentTarget);popup.set("content",'<img src="'+t.one("img").attr("bigpicurl")+'"/>');popup.set("align",{node:t,points:["tr","tl"],offset:[0,0]});popup.show()});Event.delegate(rankPanels,"mouseleave","div.pic",function(e){popup.hide()})}});TopList.selector=".tshop-pbsm-stl10c";return TopList},{requires:["core","switchable","overlay","node"]});KISSY.add("wangpu/mods/official/self-defined",function(c,f){var e=document,d=c.DOM,b=c.Event;function a(h){var g=this;g._mod=h.mod;if(!g._mod){return}g._init()}c.augment(a,{_init:function(){c.log("SelfDefined init start");var g=this;g._initFilter();c.log("SelfDefined init end")},_initFilter:function(){var q=this,i="\u60a8\u9009\u4e2d\u7684\u5185\u5bb9\u53ef\u80fd\u6709\u5b89\u5168\u9690\u60a3,\u8bf7\u8c28\u614e\u4f7f\u7528! ",h=d.get(".shop-custom",q._mod),k=e.createElement("div"),o="<.+(?:",p=").+>",m="\\s*",n=/[\r\n]+/g,g=[["display","none"],["visibility","hidden"],["width","0"],["text-indent","-\\d{3,}"]],j=[],l,r;c.each(g,function(s){j.push(s[0]+m+":"+m+s[1])});l=o+j.join("|")+p;r=new RegExp(l,"mi");b.on(h,"copy",function(t){var s,u;if(window.getSelection){s=window.getSelection()}else{if(e.selection){s=e.selection.createRange()}}u=s.htmlText||s.getRangeAt(0).cloneContents();if("string"!==typeof u){k.appendChild(u);u=k.innerHTML}u=u.replace(n,"");if(r.test(u)){alert(i);t.halt()}k.innerHTML=""})}});a.selector=".tshop-pbsm-ssd10c";return a},{requires:["core"]});KISSY.add("wangpu/decoration/init",function(f,g,l,b,d,a,c,e){var i=document,k=f.DOM,j=f.Event;function h(n){var m=this;m._mod=n.mod;m._context=n;if(!m._mod){return}m.init()}f.augment(h,{init:function(){var p=(new Date).getTime();f.log("Decoration init start");var o=this,n=o._context.pageType;if(!n){n="wangpu"}switch(n){case"wangpu":o.initForShopPage();break;default:o.initForOtherPage()}var m=(new Date).getTime();f.log("Decoration init end");f.log("Decoration init spend time ms:"+(m-p))},initForShopPage:function(){var m=this;f.ready(function(){m.initWidget("J_TWidget",m._mod);m.initPicLazyload();m.initCartPlugin();m.initISV();m.initBuriedStatistics();m.handleDesignEntr()})},initForOtherPage:function(){var m=this;f.ready(function(){m.initWidget("J_TWidget",m._mod);m.initPicLazyload();m.initCartPlugin();m.initISV()})},preprocessImg:function(){var o=[],n=0,m=0;if(!f.isArray(this._context.lazyContainers)){o[0]=this._context.lazyContainers}else{o=this._context.lazyContainers}f.each(o,function(p){f.each(k.query("img",p),function(q){if(!q.offsetWidth&&k.attr(q,"data-ks-lazyload")){k.attr(q,"src",k.attr(q,"data-ks-lazyload"));k.removeAttr(q,"data-ks-lazyload");m++}n++})});f.log("img nums:"+n);f.log("display none img nums:"+m)},initPicLazyload:function(){this.preprocessImg();new c(this._context.lazyContainers,{mod:"manual",diff:{left:9999,right:9999,top:0,bottom:500}})},initWidget:function(t,n){var v=this;var o=(new Date).getTime();t="."+(t||"KS_Widget");var m={switchable:"Tabs Slide Carousel Accordion",overlay:"Popup",compatible:"Compatible",countdown:"Countdown"},p,x=f.query(t,"#content");q();function q(){f.later(function(){if(x.length!==0){s(x.shift());q()}},0)}function s(B){var A=B.getAttribute("data-widget-type"),y;if(!A){return}try{y=B.getAttribute("data-widget-config");if(y){y=y.replace(/'/g,'"')}y=f.JSON.parse(y);switch(true){case m.switchable.indexOf(A)>-1:r(B,f.merge(l.Config,f.merge(l[A].Config,y)));if(A=="Carousel"&&!(k.get("."+y.prevBtnCls,B)&&k.get("."+y.nextBtnCls,B))){new l(B,f.merge(y,{lazyDataType:"img-src"}))}else{new l[A](B,f.merge(y,{lazyDataType:"img-src"}))}break;case m.overlay.indexOf(A)>-1:w(y,B);break;case m.compatible.indexOf(A)>-1:if(f.UA.ie&&f.UA.ie<7){new d(B,y)}break;case m.countdown.indexOf(A)>-1:new a(B,y.endTime,y);break;default:f.log("\u5728kissy\u5e93\u4e2d\u6ca1\u6709\u67e5\u627e\u5230\u4f60\u60f3\u8981\u521d\u59cb\u5316\u7684\u7ec4\u4ef6")}}catch(z){f.log("widget "+z,"warn")}}function r(y,z){var H=z.activeIndex;if(H>-1){}else{if(typeof z.switchTo=="number"){}else{H=0}}var B,D=".",C,F=z.steps,G=H*F,A=[];var E=y.getAttribute("data-widget-type");switch(z.markupType){case 0:B=k.get(D+z.contentCls,y);C=k.children(B);break;case 1:C=k.query(D+z.panelCls,y);break;case 2:C=z.panels;break}f.each(C,function(I,J){if(G<=J&&J<G+F){f.each(k.query("img",I),function(K){if(k.attr(K,"data-ks-lazyload")){k.attr(K,"src",k.attr(K,"data-ks-lazyload"));k.removeAttr(K,"data-ks-lazyload")}})}else{A=A.concat(k.query("img",I));if(E=="Slide"){k.css(I,"display","none")}}});f.each(A,function(I){if(k.attr(I,"data-ks-lazyload")){k.attr(I,"data-ks-lazyload-custom",k.attr(I,"data-ks-lazyload"));k.removeAttr(I,"data-ks-lazyload")}})}function w(A,D){if(!("type" in A)){if(!A.content){A.type="one-one"}else{A.type="multi-one"}}if(!A.triggerType){A.triggerType="mouse"}if(!A.triggerType){A.triggerType="mouse"}if(k.parent(A.trigger,"#hd")){if(!A.zIndex||A.zIndex>100000000+100||A.zIndex<100000000){A.zIndex=100000000}}else{if(!A.zIndex||A.zIndex>100000000-100||A.zIndex<100000000-200){A.zIndex=100000000-200}}if(A.type=="one-one"){new b.Popup({trigger:k.get(A.trigger,v._mod),triggerType:A.triggerType,srcNode:D,elStyle:{display:"block",visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px"},align:A.align,zIndex:A.zIndex})}else{var z=new b({effect:A.effect?A.effect:{},zIndex:A.zIndex});var y=k.get(A.container),B=k.query(A.trigger,y),C=k.query(A.content,y);f.each(B,function(F,E){var G,H;j.on(F,"mouseenter",function(){if(G){G.cancel()}G=f.later(function(){if(C[E]){z.set("content",C[E].value);z.set("align",f.merge(A.align,{node:F}));z.show()}G.cancel()},100)});j.on(F,"mouseleave",function(){if(H){H.cancel()}H=f.later(function(){z.hide();H.cancel()},100)})})}}var u=(new Date).getTime();f.log("widget init spend time ms:"+(u-o))},initCartPlugin:function(){var m=this;if(k.get(".J_CartPluginTrigger")){f.getScript("http://a.tbcdn.cn/apps/cart/plugin/1.2/cartplugin.js",function(){if(typeof CartPlugin!=="undefined"){CartPlugin.init(m._mod,{preventAll:true})}})}},initBuriedStatistics:function(){f.getScript("http://a.tbcdn.cn/apps/lz/hc.js?v=5");f.getScript("http://a.tbcdn.cn/s/tb-tracer-min.js?t=20110628")},initISV:function(){e.init(this._context.isvParams)},handleDesignEntr:function(){if(window.shop_config&&window.login_config){if(shop_config.userId==login_config.loginUserId){k.removeClass("#J_DesignPage","hidden")}}}});h.selector="#content";h.type="decoration";return h},{requires:["core","switchable","overlay","./compatible","./countdown","datalazyload","./isv"]});KISSY.add("wangpu/decoration/compatible",function(e,f){var i=e.DOM,h=e.Event,d=/px[;]{0,1}/g,c="http://img04.taobaocdn.com/tps/i4/T1VhujXXBkXXXXXXXX-1-1.gif",g=true,a=/\w+\.png$/;function b(k,j){var l={top:"auto",bottom:"auto",left:"auto",right:"auto"};l.top=i.css(k,"top");l.bottom=i.css(k,"bottom");if(l.bottom!=="auto"){l.top="auto"}l.left=i.css(k,"left");l.right=i.css(k,"right");j=j||{};j=e.merge(b.Config,j);this.offset=l;this.config=j;this.elem=e.get(k);this._init()}b.Config={fixed:false,png:false,png_bg:false,png_tag:false,png_method:"crop",maxWidth:false,maxHeight:false,minWidth:false,minHeight:false,maxWidthValue:0,maxHeightValue:0,minWidthValue:0,minHeightValue:0};e.augment(b,{_init:function(){var k=this,j=k.config;if(j.fixed){k._fixIE6PositionFixed()}if(j.png){k._fixIE6PngTransparent()}if(j.maxWidth&&k._isValidWidthValue()){k._fixMaxWidth()}if(j.maxHeight&&k._isValidHeightValue()){k._fixMaxHeight()}if(j.minWidth&&k._isValidWidthValue()){k._fixMinWidth()}if(j.minHeight&&k._isValidHeightValue()){k._fixMinHeight()}},_fixIE6PositionFixed:function(){var j=this;i.css(j.elem,"position","absolute");h.on(window,"scroll resize",function(o){var n=j.offset.top&&j.offset.top!=="auto"?i.scrollTop()+parseInt(j.offset.top.toString().replace(d,""))+"px":"auto",k=j.offset.bottom&&j.offset.bottom!=="auto"&&n==="auto"?i.scrollTop()+i.viewportHeight()-parseInt(j.offset.bottom.toString().replace(d,""))-i.height(j.elem)+"px":"auto",m=j.offset.left||"auto",l=j.offset.right||"auto";if(n=="auto"){i.css(j.elem,"top",k)}else{i.css(j.elem,"top",n)}i.css(j.elem,"left",m);i.css(j.elem,"right",l);i.css(j.elem,"bottom",k)})},_fixIE6PngTransparent:function(){var k=this,j=k.config;if(j.png_bg==true){k._bg_fnFixPng(k.elem,j)}if(j.png_tag==true){k._el_fnFixPng(k.elem);if(g&&(k.elem.tagName=="A"||k.elem.tagName=="INPUT")&&k.elem.style.position==""){k.elem.style.position="relative"}k._childrenFix(k.elem)}},_bg_fnFixPng:function(l,j){var k=l.currentStyle.backgroundImage,m=k.substring(5,k.length-2);if(!a.test(m)){return}l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+m+"', sizingMethod='"+j.png_method+"')";l.style.backgroundImage="url("+c+")"},_el_fnFixPng:function(j){var k=j.src;if(!a.test(k)){return}j.style.width=j.width+"px";j.style.height=j.height+"px";j.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+k+"', sizingMethod='scale')";j.src=c},_childrenFix:function(n){var k=["a","input","select","textarea","button"],l=k.length;while(l--){var j=n.all.tags(k[l]),m=j.length;while(m--){if(!/relative|absolute/i.test(j[m].currentStyle.position)){j[m].style.position="relative"}}}},_isValidWidthValue:function(){var k=this,j=k.config;if(j.maxWidth&&j.minWidth){if(j.maxWidthValue<j.minWidthValue){return false}}return true},_isValidHeightValue:function(){var k=this,j=k.config;if(j.maxHeight&&j.minHeight){if(j.maxHeightValue<j.minHeightValue){return false}}return true},_fixMaxWidth:function(){var k=this,j=k.config;if(k.elem&&i.width(k.elem)>j.maxWidthValue){i.css(k.elem,"width",j.maxWidthValue+"px")}},_fixMaxHeight:function(){var k=this,j=k.config;if(k.elem&&i.height(k.elem)>j.maxHeightValue){i.css(k.elem,"height",j.maxHeightValue+"px")}},_fixMinHeight:function(){var k=this,j=k.config;if(k.elem&&i.height(k.elem)<j.minHeightValue){i.css(k.elem,"height",j.minHeightValue+"px")}},_fixMinWidth:function(){var k=this,j=k.config;if(k.elem&&i.width(k.elem)<j.minWidthValue){i.css(k.elem,"width",j.minWidthValue+"px")}}});return b},{requires:["core"]});KISSY.add("wangpu/decoration/countdown",function(d,e){var h=d.DOM,i={d:86400000,h:3600000,m:60000,s:1000,i:1},c=["d","h","m","s","i"];function f(l,k){var j=this;cfg={timeBegin:0,collateurl:"",collateval:0};j.timeStart=new Date;j.config=d.merge(cfg,k||{});j._countTime(l)}f.prototype={_countTime:function(m){var l=this,k=l.config,n=k.timeBegin,j=0;if(/^(\d{4})\-(\d{1,2})\-(\d{1,2})(\s+)(\d{1,2}):(\d{1,2}):(\d{1,2})$/ig.test(m.replace(/\./g,"-"))){var o=m.match(/\d+/g);m=new Date(o[0],o[1]-1,o[2],o[3],o[4],o[5])}else{if(/^\d+&/.test(m)){m=parseInt(m)}}if(d.isNull(n)||isNaN(n)||n<=0){if(d.isDate(m)){j=m-new Date}else{j=parseInt(m)}}else{j=typeof n==typeof m?m-n:0}if(!d.isNumber(j)||j<0){j=0}l.timeRemain=j},getRemain:function(){var j=parseInt(this.timeRemain-(new Date-this.timeStart));if(isNaN(j)||j<=0){return 0}else{return j}},format:function(l){var k=Array.prototype.slice.call(arguments,1);var j=[];d.each(k,function(n){if(i[n]){var m=Math.floor(l/i[n]);l=l-m*i[n];j.push(m)}});return j},fetch:function(k,m,l){var j=this,n=setInterval(function(){var o=j.getRemain();if(o>0){m&&m.call(j,o)}else{m&&m.call(j,0);l&&l.call(j);clearInterval(n)}},k)}};function a(l,n,m){var k={d:".ks-d",h:".ks-h",m:".ks-m",s:".ks-s",i:".ks-i"},o={interval:1000,timeUnitCls:k,minDigit:2,timeRunCls:".ks-countdown-run",timeEndCls:".ks-countdown-end"},j=d.merge(o,m);if(j.run&&!d.isFunction(j.run)){delete j.run}if(j.end&&!d.isFunction(j.end)){delete j.end}j.interval=parseInt(j.interval);if(isNaN(j.interval)||j.interval<200){j.interval=200}a.superclass.constructor.call(this,n,j);this.counter(l)}d.extend(a,f,{counter:function(k){var s=this,q=s.config,m=function(u){var t=[u].concat(r),v=s.format.apply(this,t);d.each(j,function(x,w){x.text(v[w])});q.run&&q.run.call(s,t,v)},n=function(){l.hide();p.show();q.end&&q.end.call(s)},o=q.timeUnitCls,k=d.one(k),l=k.all(q.timeRunCls),p=k.all(q.timeEndCls),j=[],r=[];d.each(c,function(t){if(o[t]&&k.one(o[t])){j.push(k.one(o[t]));r.push(t)}});l.show();p.hide();s.fetch(q.interval,m,n)}});function g(j,l){var k=function(m){if(!d.isDate(m)){m=new Date}if(d.isFunction(l)){l(m)}};d.io({url:j,type:"HEAD",success:function(o,m,n){k(new Date(n.getResponseHeader("date")))},error:function(){k(new Date)},cache:false})}function g(l,n){var m=0;function k(p,o){if(p<1000){n(o)}else{if(m<3){j()}else{n(new Date(o.setMilliseconds(o.getMilliseconds()+p/2)))}}}function j(){var o=new Date;m++;d.io({url:l,type:"HEAD",success:function(r,p,q){k(new Date-o,new Date(q.getResponseHeader("date")))},error:function(){k()},cache:false})}j()}function b(m,j,k){m="."+(m||"J_TWidget");var l=function(n){d.query(m,j).each(function(q){var p=h.attr(q,"data-widget-type"),o=h.attr(q,"data-widget-config");if(p!=="Countdown"){return}if(d.isNull(o)){o={}}else{o=JSON.parse(o.replace(/'/g,'"'))}if(n&&d.isDate(n)){o.timeBegin=n}new d.Countdown(q,o.endTime,o)})};if(k){g(k,l)}else{l()}}a.autoRender=b;a.Core=f;a.getServerTime=g;d.Countdown=a;return a},{requires:["core"]});KISSY.add("wangpu/decoration/isv",function(a){TB.namespace("ISV");var e=[{isvParam:"u_name/u_visitor/u_item_id/u_item_num_id/u_aload_id/u_session/u_preurl/u_curl/u_title/u_time",isvUrl:""},{isvParam:"u_name/u_visitor/u_item_id/u_item_num_id/u_aload_id/u_session/u_preurl/u_curl/u_title/u_time",isvUrl:"http://tblog.tj.haodianpu.com/tj/tblog.php"},{isvParam:"u_name/u_template_name/u_template_id/u_preurl/u_title",isvUrl:"http://c10.taobao.fenxi001.com/c"}];var a=KISSY,d=window,c=document;var b=function(){var i={},j=/^http\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?$/;var k=function(p){if(true===i.debugMode){alert(p)}return false};var m=function(p){if(0<c.cookie.length){var q=c.cookie.match(new RegExp("(^| )"+p+"=([^;]*)(;|$)"));return null===q?"":q[2]}return""};var o=function(){return Math.ceil(Math.random()*1000000000).toString()};var h=function(){return(+new Date).toString().substring(0,10)};var n=function(){var p="";try{if(""!==c.referrer){p=c.referrer}else{if(null!==d.opener&&undefined!==d.opener){p=(d.opener.document||0).URL||""}else{if(null!==d.parent){p=d.parent.document.URL;if(p===c.URL){p=c.referrer}}}}}catch(q){}return p};var g=function(p){var q=h();var r=[o(),"0",q];return r.join("_")};var l=function(B){var v={u_name:i.nickName.toString(),u_item_id:i.itemId.toString(),u_item_num_id:i.itemNumId.toString(),u_template_name:i.templateName.toString(),u_template_id:i.templateId.toString(),u_visitor:m(i.cnaCookieName),u_session:g(B),u_preurl:encodeURIComponent(n()),u_curl:encodeURIComponent(c.URL),u_title:encodeURIComponent(c.title),u_aload_id:d.acookie_load_id||"",u_time:h()};var r=[];for(var y=0,w=B.length;y<w;y++){var A=B[y];if(String===A.isvUrl.constructor&&String===A.isvParam.constructor){if(true===j.test(A.isvUrl)&&false!==A.isvParam.indexOf("_")){var u=A.isvParam.toLowerCase().replace(/\s+/g,"").split("/");if(0<u.length){var x="";for(var t=0,s=u.length;t<s;t++){var z=u[t];if(undefined!==v[z]){x+="&"+z+"="+v[z]}}if(""!==x){x=x.replace("&","?");r[y]=new Image(1,1);r[y].src=A.isvUrl+x;r[y].onload=function(){return k("Send Successfully")}}}}else{}}else{}}};var f=function(){if("-1"===i.shopStats||"-2"==i.shopStats||isNaN(i.shopStats)){a.log(i.validatorUrl+"?nickName="+i.nickName.toString()+"&userId="+i.userId.toString()+"&itemNumId="+i.itemNumId.toString()+"&shopId="+i.shopId.toString()+"&siteId="+i.siteId.toString()+"&shopStats="+i.shopStats.toString());a.getScript(i.validatorUrl+"?nickName="+i.nickName.toString()+"&userId="+i.userId.toString()+"&itemNumId="+i.itemNumId.toString()+"&shopId="+i.shopId.toString()+"&siteId="+i.siteId.toString()+"&shopStats="+i.shopStats.toString(),function(){if(undefined===TB.ISV.Data||Array!==TB.ISV.Data.constructor||0===TB.ISV.Data.length){return k("Cannot get the valid data")}var s=TB.ISV.Data;delete TB.ISV.Data;l(s)})}else{if(i.shopStats>0){var p=[],r,q=parseInt(i.shopStats);for(r=0;r<e.length;r++){if((q&Math.pow(2,r))>0){p.push(e[r])}}l(p)}}};return{init:function(q){i=q||{};a.mix(i,{nickName:"",userId:"",shopId:"",templateName:"",templateId:"",itemId:"",itemNumId:"",siteId:"",shopStats:"-2",cnaCookieName:"cna",sessionLife:1400,validatorUrl:"http://store.taobao.com/tadget/shop_stats.htm",debugMode:false},false);if(""===i.itemId&&-1!==c.URL.indexOf("?taomi=")){var p=$("J_FrmBid");if(null!==p&&p.elements.item_id){i.itemId=p.elements.item_id.value}}switch(true){case""===i.nickName&&""===i.userId&&""===i.shopId:return k("nickName and userId and shopId are all null");break;case""===i.cnaCookieName:return k("cnaCookieName is null");break;case Number!==i.sessionLife.constructor:return k("sessionLife is not a number");break;case false===j.test(i.validatorUrl):return k("validatorUrl is not a valid url");break}f()}}}();return b});