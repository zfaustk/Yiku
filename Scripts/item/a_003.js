/*pub-1|2013-04-09 11:52:55*/(function(D,A){if(D.util){return }var C=/(\bspm=(\d+.){3})\w+\b/g;var B=Object.prototype.toString;D.util={BASEURL:D.dev?"http://127.0.0.1/apps/tmall/ald":"http://l.tbcdn.cn/apps/tmall/ald",TIMESTAMP:"20120623",renders:{},add:function(H,G){var E=D.util;if(H in E.renders){A.log("render("+H+")\u5df2\u7ecf\u5b58\u5728\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0");return }function I(F){I.superclass.constructor.call(this,F)}A.extend(I,E.BaseRender);if(A.isFunction(G)){G(I,E,A)}E.renders[H]=I;if(I.template){I.tpl=E.juicer(I.template.replace(/\bALDCLS\b/g,"ald-"+H))}I.cssText&&E.addStyleSheet(I.cssText);D.fire("renderLoadSuccess",{render:H,renderFn:I})},mockup:function(E){var G=A.DOM;if(E.el){return true}var H=G.get(E.render||E.renderAfter||E.renderBefore);if(H||A.isFunction(E.renderFn)){var F=G.data(H,"ald-render-el-"+E.appId);if(!F){F=document.createElement("div");F.className="ald"+(E.showLoading?" ald-loading":"");G.data(F,"ald-inited",true);if(E.showLoading){F.innerHTML="\u6b63\u5728\u52a0\u8f7d\u4e2d..."}if(E.renderFn){E.renderFn(F)}else{if(E.render){H.appendChild(F)}else{if(E.renderAfter){G.insertAfter(F,H)}else{H.parentNode.insertBefore(F,H)}}}G.data(H,"ald-render-el-"+E.appId,F)}E.el=F;return true}else{A.log("ALD:\u6307\u5b9a\u7684\u6e32\u67d3\u4f4d\u7f6e\u4e0d\u5b58\u5728\uff0c\u4e5f\u6ca1\u6709\u6307\u5b9arenderFn\u51fd\u6570");return false}},invokeRender:function(G,F,E){var H=D.util,M=A.DOM;var L=E.appId;var K=H.getModuleConfig(L);E.showLoading=E.showLoading||true;if(!H.mockup(E)){return }var J=function(P){var O=E.el;var N=M.data(O,"ald-render-obj-"+E.appId);if(!N){N=new P(E);M.data(O,"ald-render-obj-"+E.appId,N)}N.setData(E.data);D.fire("beforeRender",{config:E,render:N});N.exec();D.fire("afterRender",{render:N,config:E})};var I=H.renders[K.render];I?J(I):D.on("renderLoadSuccess",function(N){if(K.render===N.render){J(N.renderFn);D.detach("renderLoadSuccess",arguments.callee)}})},combineDOM:function(I,G,L){var H=A.DOM,E,K=[],J=[],F={};if(!I||!G||!L||!H.get(".ald-"+I)||!H.get(".ald-"+G)){return }E=H.get(".ald-"+G);A.each(H.query(".ald-"+G+"-act",E),function(N){var M=H.attr(N,"data-sellerid");var O=H.attr(N,"title");if(M){F[M]=O}});if(L.datalist){A.each(L.datalist,function(M){K.push(M.sellerId)});E=H.get(".ald-"+I);A.each(H.query(".ald-"+I+"-info",E),function(N){var M=H.attr(H.query("a",N),"data-sellerid");if(M&&A.inArray(M,K)){J.push(M);H.append(H.create('<div class="ald-'+I+'-act"><strong>\u6d3b\u52a8: </strong><span>'+(typeof F[M]==="string"?F[M].split("-")[0]:"")+"</span></div>"),N)}});E=H.get(".ald-"+G);A.each(H.query(".ald-"+G+"-act",E),function(N){var M=H.attr(N,"data-sellerid");if(M&&A.inArray(M,J)){H.remove(H.parent(N,"li"),E)}});if(!H.query("li",E).length){H.remove(E)}}else{if(L.shopByZscore){A.each(L.shopByZscore,function(M){K.push(M.sellerId)});E=H.get(".ald-"+G);A.each(H.query(".ald-"+G+"-act",E),function(N){var M=H.attr(N,"data-sellerid");if(M&&A.inArray(M,K)){J.push(M);H.remove(H.parent(N,"li"),E)}});if(!H.query("li",E).length){H.remove(E)}E=H.get(".ald-"+I);A.each(H.query(".ald-"+I+"-info",E),function(N){var M=H.attr(H.query("a",N),"data-sellerid");if(M&&A.inArray(M,J)){H.append(H.create('<div class="ald-'+I+'-act"><strong>\u6d3b\u52a8: </strong><span>'+(typeof F[M]==="string"?F[M].split("-")[0]:"")+"</span></div>"),N)}})}}},escapeSPM:function(F,G,E){if(A.isPlainObject(F)&&A.isString(F[G])){F[G]=F[G].replace(C,"$1"+(E+1))}},substitute:function(F,E){return F.replace(/{(\w+)}/g,function(H,G){return E[G]||""})},adjustImages:function(J,F,K){if(!A.isArray(J)){J=[J]}var I=this.fitImage;for(var H=0,E=J.length;H<E;H++){var G=J[H];if(G.complete){I(G,F,K)}else{G.onload=function(){I(this,F,K)}}}},fitImage:function(H,F,J){var G=H.width;var E=H.height;var I=false;if(!G||!E){return }if(G>F){E=E*F/G;G=F;I=true}if(E>J){G=G*J/E;E=J;I=true}if(I){H.width=G;H.height=E}},addStyleSheet:function(G){var F=document.createElement("style"),E=document.getElementsByTagName("head")[0];E.appendChild(F);if(F.styleSheet){F.styleSheet.cssText=G}else{F.appendChild(document.createTextNode(G))}},substr:function(G,F,H){if(!G){return""}F=F-0;if(!F){return G}var E=G.length;return G.substr(0,F)+(G.length>F?(H||"..."):"")},csubstr:function(J,F,K){if(!J){return""}F=F-0;if(!F){return J}var I="";var H=0;for(var G=0,E=J.length;G<E;G++){H+=J.charCodeAt(G)>255?2:1;if(H>F){I+=K||"...";break}I+=J.charAt(G)}return I}};D.util.addStyleSheet(".ald-word-spliter{display:inline-block;} a:hover .ald-word-spliter{ cursor: pointer; } .ald-itemlist{ overflow: hidden; } .ald-itemlist .ald-item{ float: left; overflow: hidden; } .ald-itemlist .ald-item .ald-title{ height: 32px; line-height: 16px; margin: 4px 0; overflow: hidden; } .ald-itemlist .ald-item .ald-title a{ color: #666; } .ald-itemlist .ald-item .ald-price,.ald-itemlist .ald-item .ald-macketPrice{ font-family: arial; color: #b5b5b5; } .ald-itemlist .ald-item .ald-price{ color: #c00; margin-right:10px;  } .ald-itemlist .ald-item .ald-rmb{ margin-right:2px; font-weight: normal;  } .ald-itemlist .ald-item .ald-meta{ height: 18px; line-height: 18px; overflow: hidden; white-space: nowrap; } .ald-rate{ background:url(http://img02.taobaocdn.com/tps/i2/T1yaLsXk8kXXauxx.j-60-174.png) no-repeat; width: 60px; height: 12px; overflow: hidden; display: block; } .ald-rate em{ visibility: hidden; } .ald-rate-45,.ald-rate-46,.ald-rate-47,.ald-rate-48,.ald-rate-49{ background-position: 0 -16px; } .ald-rate-4,.ald-rate-41,.ald-rate-42,.ald-rate-43,.ald-rate-44{ background-position: 0 -32px; } .ald-rate-35,.ald-rate-36,.ald-rate-37,.ald-rate-38,.ald-rate-39{ background-position: 0 -49px; } .ald-rate-3,.ald-rate-31,.ald-rate-32,.ald-rate-33,.ald-rate-34{ background-position: 0 -66px; } .ald-rate-25,.ald-rate-26,.ald-rate-27,.ald-rate-28,.ald-rate-29{ background-position: 0 -83px; } .ald-rate-2,.ald-rate-21,.ald-rate-22,.ald-rate-23,.ald-rate-24{ background-position: 0 -99px; } .ald-rate-15,.ald-rate-16,.ald-rate-17,.ald-rate-18,.ald-rate-19{ background-position: 0 -115px; } .ald-rate-1,.ald-rate-11,.ald-rate-12,.ald-rate-13,.ald-rate-14{ background-position: 0 -131px; } .ald-rate-05,.ald-rate-06,.ald-rate-07,.ald-rate-08,.ald-rate-09{ background-position: 0 -147px; } .ald-rate-0,.ald-rate-01,.ald-rate-02,.ald-rate-03,.ald-rate-04{ background-position: 0 -163px; }     ")})(ALD,KISSY);/*pub-1|2013-05-16 16:44:21*/(function(a,c){if(a.use){return}var f={common:{},"03028":{t:"20120711"},"03032":{t:"20121021"},"03013":{t:"20120710"},"03035":{t:"20130506"},"03036":{t:"20120718"},"03037":{t:"20120718"},"03031":{t:"20120713"},"07001":{t:"20120710"},"03039":{t:"20130409"},"03042":{t:"20121210"},"03044":{t:"20121021"},"03046":{t:"20121228"},"03047":{t:"20130116"},"03048":{t:"20130116"},"03054":{t:"20130516"}};var e={};var b=a.TIMESTAMP;var d=a.BASEURL;var h=function(k){var j=f[k];if(j&&!j.configed){var i=j.inherit;if(i in f){h(i);j=c.merge(f[i],j)}if(!("render" in j)){j.render=k}if(!("t" in j)){j.t=b}j.configed=true;f[k]=j}return j};var g=function(j,l,n){if(!j){return}j=j+"."+l;if(j in e){return}e[j]=true;var i=d+"/mods/"+j+"?"+n;var o=document;var m;if("js"===l){m=o.createElement("script");m.async=true;m.src=i}else{m=o.createElement("link");m.rel="stylesheet";m.href=i}m.charset="gbk";var k=o.getElementsByTagName("head")[0];k.insertBefore(m,k.firstChild)};a.use=function(j){if(!(j in f)){c.log("\u6307\u5b9a\u7684appId("+j+")\u672a\u914d\u7f6e\uff0c\u65e0\u6cd5use");return false}var i=h(j);g(i.style,"css",i.t);g(i.render,"js",i.t);return true};a.getModuleConfig=function(i){return h(i)}})(ALD.util,KISSY);/*pub-1|2013-01-04 14:47:24*/(function(A,B){if(A.effect){return }var D=B.isFunction;var C={tab:function(F,H){var G=B.DOM,E=B.Event;B.each(G.query(".ald-tab"),function(I){var L=G.query(".ald-tab-trigger",I);var J=G.query(".ald-tab-panel",I);if(L.length&&L.length===J.length){var M,K;B.each(L,function(O,N){if(G.hasClass(O,"ald-tab-trigger-active")){K=O;M=J[N]}E.on(O,"click",function(P){P.halt();if(M){M.style.display="none";G.removeClass(K,"ald-tab-trigger-active")}K=this;M=J[N];M.style.display="block";G.addClass(K,"ald-tab-trigger-active")})});if(!K){L[0].click()}}})},carousel:function(F,H,I){var G=B.DOM;var E=G.hasClass(F,"ald-carousel")?F:G.get(".ald-carousel",F);if(!E){return }B.use("switchable,datalazyload",function(K,J){var M=K.Carousel||J.Carousel;var L=new M(E,K.merge({contentCls:"ald-switchable-content",triggerCls:"ald-switchable-trigger",effect:"scrolly",circular:true,hasTriggers:false,prevBtnCls:"ald-switchable-prev-btn",nextBtnCls:"ald-switchable-next-btn",disableBtnCls:"ald-switchable-disable-btn",easing:"easeOutStrong",viewSize:[150,450],lazyDataType:"img-src",steps:3},H));G.data(F,"ald-carousel",L);if(D(I)){I()}})}};A.effect=function(G,H,I){if(D(H)){I=H;H={}}for(var F in C){var E=C[F];if(D(E)){E(G,H,I)}}};A.effects=C})(ALD.util,KISSY);/*pub-1|2012-12-06 18:53:31*/(function(A){if(A.BaseRender){return }function B(C){this.el=C.el;this.data=C.data;this.config=C;this._super=B;this.initialize()}B.prototype={setData:function(C){this.data=C;if(this.config){this.config.data=C}},initialize:function(){},exec:function(){},hasUsableData:function(){return false},setHtml:function(E){var D=KISSY;var G=D.DOM;var C=this.config,F=this.el;G.removeClass(F,"ald-loading");G.addClass(F,"ald-"+C.appId);F.innerHTML=E},stat:function(C){if(typeof C==="string"){new Image().src=C}},sendExposure:function(C){if(!C){return }if(C.indexOf("1.gif")==-1){C="http://ac.atpanel.com/1.gif?"+C}this.stat(C.replace(/([?&]cache=)[\d\[\]]+\b/,"$1"+ +new Date()))}};A.BaseRender=B})(ALD.util);/*pub-1|2012-12-27 19:09:14*/(function(A){var D=function(){var F=[].slice.call(arguments);F.push(D.options);if(F[0].match(/^\s*#([\w:\-\.]+)\s*$/igm)){F[0].replace(/^\s*#([\w:\-\.]+)\s*$/igm,function(I,J){var G=document;var H=G&&G.getElementById(J);F[0]=H?(H.value||H.innerHTML):I})}if(arguments.length==1){return D.compile.apply(D,F)}if(arguments.length>=2){return D.to_html.apply(D,F)}};var E={escapehash:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},escapereplace:function(F){return E.escapehash[F]},escaping:function(F){return typeof (F)!=="string"?F:F.replace(/[&<>"]/igm,this.escapereplace)},detection:function(F){return typeof (F)==="undefined"?"":F}};var C=function(F){if(console){if(console.warn){console.warn(F);return }if(console.log){console.log(F);return }}throw (F)};var B=function(I,G){I=I!==Object(I)?{}:I;if(I.__proto__){I.__proto__=G;return I}var H=function(){};var J=Object.create?Object.create(G):new (H.prototype=G,H);for(var F in I){if(I.hasOwnProperty(F)){J[F]=I[F]}}return J};D.__cache={};D.version="0.5.2-stable";D.settings={};D.tags={operationOpen:"{@",operationClose:"}",interpolateOpen:"\\${",interpolateClose:"}",noneencodeOpen:"\\$\\${",noneencodeClose:"}",commentOpen:"\\{#",commentClose:"\\}"};D.options={cache:true,strip:true,errorhandling:true,detection:true,_method:B({__escapehtml:E,__throw:C},this)};D.tagInit=function(){var F=D.tags.operationOpen+"each\\s*([\\w\\.]*?)\\s*as\\s*(\\w*?)\\s*(,\\s*\\w*?)?"+D.tags.operationClose;var H=D.tags.operationOpen+"\\/each"+D.tags.operationClose;var I=D.tags.operationOpen+"if\\s*([^}]*?)"+D.tags.operationClose;var J=D.tags.operationOpen+"\\/if"+D.tags.operationClose;var N=D.tags.operationOpen+"else"+D.tags.operationClose;var O=D.tags.operationOpen+"else if\\s*([^}]*?)"+D.tags.operationClose;var K=D.tags.interpolateOpen+"([\\s\\S]+?)"+D.tags.interpolateClose;var L=D.tags.noneencodeOpen+"([\\s\\S]+?)"+D.tags.noneencodeClose;var M=D.tags.commentOpen+"[^}]*?"+D.tags.commentClose;var G=D.tags.operationOpen+"each\\s*(\\w*?)\\s*in\\s*range\\((\\d+?)\\s*,\\s*(\\d+?)\\)"+D.tags.operationClose;D.settings.forstart=new RegExp(F,"igm");D.settings.forend=new RegExp(H,"igm");D.settings.ifstart=new RegExp(I,"igm");D.settings.ifend=new RegExp(J,"igm");D.settings.elsestart=new RegExp(N,"igm");D.settings.elseifstart=new RegExp(O,"igm");D.settings.interpolate=new RegExp(K,"igm");D.settings.noneencode=new RegExp(L,"igm");D.settings.inlinecomment=new RegExp(M,"igm");D.settings.rangestart=new RegExp(G,"igm")};D.tagInit();D.set=function(G,J){var I=this;var F=function(L){return L.replace(/[\$\(\)\[\]\+\^\{\}\?\*\|\.]/igm,function(M){return"\\"+M})};var K=function(M,N){var L=M.match(/^tag::(.*)$/i);if(L){I.tags[L[1]]=F(N);I.tagInit();return }I.options[M]=N};if(arguments.length===2){K(G,J);return }if(G===Object(G)){for(var H in G){if(G.hasOwnProperty(H)){K(H,G[H])}}}};D.register=function(H,G){var F=this.options._method;if(F.hasOwnProperty(H)){return false}return F[H]=G};D.unregister=function(G){var F=this.options._method;if(F.hasOwnProperty(G)){return delete F[G]}};D.template=function(F){var G=this;this.options=F;this.__interpolate=function(H,M,K){var J=H.split("|"),L="",I;if(J.length>1){H=J.shift();I=J.shift().split(",");if(I.length>1){L="_method."+I.shift()+".call({}, "+[H].concat(I)+")"}else{L="_method."+I[0]+"("+H+")"}}else{L=H}return"<%= "+(M?"_method.__escapehtml.escaping":"")+"("+(!K||K.detection!==false?"_method.__escapehtml.detection":"")+"("+L+")) %>"};this.__removeShell=function(I,H){var J=0;I=I.replace(D.settings.forstart,function(O,L,N,M){var N=N||"value",M=M&&M.substr(1);var K="i"+J++;return"<% for(var "+K+"=0, l"+K+"="+L+".length;"+K+"<l"+K+";"+K+"++) {var "+N+"="+L+"["+K+"];"+(M?("var "+M+"="+K+";"):"")+" %>"}).replace(D.settings.forend,"<% } %>").replace(D.settings.ifstart,function(K,L){return"<% if("+L+") { %>"}).replace(D.settings.ifend,"<% } %>").replace(D.settings.elsestart,function(K){return"<% } else { %>"}).replace(D.settings.elseifstart,function(K,L){return"<% } else if("+L+") { %>"}).replace(D.settings.noneencode,function(L,K){return G.__interpolate(K,false,H)}).replace(D.settings.interpolate,function(L,K){return G.__interpolate(K,true,H)}).replace(D.settings.inlinecomment,"").replace(D.settings.rangestart,function(N,M,O,L){var K="j"+J++;return"<% for(var "+K+"="+O+";"+K+"<"+L+";"+K+"++) {var "+M+"="+K+"; %>"});if(!H||H.errorhandling!==false){I="<% try { %>"+I;I+='<% } catch(e) {_method.__throw("Juicer Render Exception: "+e.message);} %>'}return I};this.__toNative=function(I,H){return this.__convert(I,!H||H.strip)};this.__lexicalAnalyze=function(K){var J=[];var N="";var H=["if","each","break","case","catch","continue","debugger","default","delete","do","finally","for","function","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","null","typeof","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield","const","arguments","true","false","undefined","NaN"];var M=function(Q,P){if(Array.prototype.indexOf&&Q.indexOf===Array.prototype.indexOf){return Q.indexOf(P)}for(var O=0;O<Q.length;O++){if(Q[O]===P){return O}}return -1};var I=function(P,O){O=O.match(/\w+/igm)[0];if(M(J,O)===-1&&M(H,O)===-1){if(window&&typeof (window[O])==="function"&&window[O].toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i)){return P}J.push(O)}return P};K.replace(D.settings.forstart,I).replace(D.settings.interpolate,I).replace(D.settings.ifstart,I).replace(D.settings.elseifstart,I).replace(/[\+\-\*\/%!\?\|\^&~<>=,\(\)]\s*([A-Za-z_]+)/igm,I);for(var L=0;L<J.length;L++){N+="var "+J[L]+"=_."+J[L]+";"}return"<% "+N+" %>"};this.__convert=function(I,J){var H=[].join("");H+="'use strict';";H+="var _=_||{};";H+="var _out=[];_out[_out.length]='";if(J!==false){H+=I.replace(/\\/g,"\\\\").replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"';_out[_out.length]=$1;_out[_out.length]='").split("<%").join("';").split("%>").join("_out[_out.length]='")+"';return _out.join('');";return H}H+=I.replace(/\\/g,"\\\\").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\n]/g,"\\n").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"';_out[_out.length]=$1;_out[_out.length]='").split("<%").join("';").split("%>").join("_out[_out.length]='")+"';return _out.join('').replace(/[\\r\\n]\\s+[\\r\\n]/g, '\\r\\n');";return H};this.parse=function(I,H){var J=this;if(!H||H.loose!==false){I=this.__lexicalAnalyze(I)+I}I=this.__removeShell(I,H);I=this.__toNative(I,H);this._render=new Function("_, _method",I);this.render=function(L,K){if(!K||K!==G.options._method){K=B(K,G.options._method)}return J._render.call(this,L,K)};return this}};D.compile=function(G,F){if(!F||F!==this.options){F=B(F,this.options)}try{var H=this.__cache[G]?this.__cache[G]:new this.template(this.options).parse(G,F);if(!F||F.cache!==false){this.__cache[G]=H}return H}catch(I){C("Juicer Compile Exception: "+I.message);return{render:function(){}}}};D.to_html=function(G,H,F){if(!F||F!==this.options){F=B(F,this.options)}return this.compile(G,F).render(H,F._method)};D.register("makeImg",function(L,K,H){if(!L){return"http://img02.taobaocdn.com/tps/i2/T18lznXj0qXXXe1I2r-1-1.png"}else{if(L.indexOf("taobaocdn")===-1){var J=0;for(var G=0,F=L.length;G<F;G++){J+=L.charCodeAt(G)}J%=4;J+=1;L="http://img0"+J+".taobaocdn.com/"+(K||"")+"/i"+J+"/"+L}if("number"===typeof K){H=K}if(H){L=L.replace(/(\.\w+)_\w+\1$/,"$1");var I=L.match(/(\.\w+)$/);L=L+"_"+H+"x"+H+(I.length?I[1]:"")}return L}});D.register("plus",function(G,F){if(typeof G=="number"&&typeof F=="number"){return G+F}return""});D.register("_escapeSPM",function(G,H,F){A.escapeSPM(G,H,F);return""});D.register("_splitByHtml",function(G,H,F){if(H&&H in G){G[F]=G[H].replace(/[^\s]/g,function(I){return'<span class="ald-word-spliter">'+I+"</span>"})}return""});D.register("renderAtpanel",function(F,G,J,L,M){if(!G){return""}else{if(!!L&&!!M){var N=G.split(","),K=N.length,H=function(P,O){if(typeof (P)==="number"&&typeof (O)==="string"){(P<K)&&(N[P]=O)}};if(L instanceof Array&&M instanceof Array&&L.length<=M.length){for(var I=0;I<L.length;I++){H(L[I],M[I])}}else{H(L,M)}G=N.join(",")}F.idx=J+1;return"atpanel='"+A.substitute(G,F)+"'"}});D.register("size",function(F){return(F?F.length:"")||""});D.register("removeCharacter",function(G,F){return(""+G).replace(F,"")});A.juicer=D})(ALD.util);/*pub-1|2013-05-06 15:38:29*/(function(ALD,S){if(ALD.request){return}if(!ALD.on){S.mix(ALD,S.EventTarget)}var win=window,DOM=S.DOM,Event=S.Event;var loadt=+new Date();var parseJsonAttr=function(el,attr,obj,key){var val=DOM.attr(el,attr);if(val){try{var json=eval("("+val+")");if(S.isPlainObject(json)){if(S.isPlainObject(obj)){obj[key]=json}return json}}catch(e){}}};ALD.load=function(loadConfig,fn){S.log("loadConfig");if(S.isString(loadConfig)){var util=ALD.util;var renderFn=util.renders[loadConfig];if(renderFn){fn(renderFn)}else{var moduleConfig=util.getModuleConfig(loadConfig);if(!moduleConfig){S.log("\u6307\u5b9a\u7684\u6a21\u5757"+loadConfig+"\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u52a0\u8f7d");return}ALD.on("renderLoadSuccess",function(ev){if(moduleConfig.render===ev.render){fn(ev.renderFn);ALD.detach("renderLoadSuccess",arguments.callee)}});util.use(loadConfig)}}else{if(S.isObject(loadConfig)){if(!ALD.util.use(loadConfig.appId)){return}ALD.request(loadConfig)}}};ALD.request=function(loadConfig,fn){var doc=document;if(!S.isPlainObject(loadConfig)){S.log("\u65e0\u6cd5\u8bf7\u6c42\u963f\u62c9\u4e01\u6570\u636e\uff0cloadCongi\u53c2\u6570\u683c\u5f0f\u4e0d\u6b63\u786e");return}if(!loadConfig.appId){S.log("\u63a8\u8350\u6a21\u5757ID\u4e3a\u7a7a\uff0c\u65e0\u6cd5\u52a0\u8f7d\u6307\u5b9a\u7684\u6a21\u5757");return}var params=loadConfig.params||{};if(S.isObject(params)&&!params.refer){params.refer=doc.referrer}var callback="ald"+S.guid(),TIMEOUT=5000,timeoutTimer=win.setTimeout(function(){ALD.fire("timeoutException")},TIMEOUT);win[callback]=function(data,params){win.clearTimeout(timeoutTimer);var config=S.merge({},loadConfig),DOM=S.DOM;var moduleConfig=ALD.util.getModuleConfig(config.appId);config.template=moduleConfig.template;config.effects=moduleConfig.effects;ALD.on("beforeRender",function(calldata){var render=calldata.render;if(render.data.acurl){render.stat(render.data.acurl);delete render.data.acurl}});data=data||[];if(S.isArray(data)){data={datalist:data}}config.data=S.merge(data,params);if(S.isFunction(fn)){fn(data,params,config)}else{ALD.util.invokeRender(data,params,config)}try{delete win[callback]}catch(e){}};var node=doc.createElement("script");node.src="http://ald.taobao.com/recommend.htm?appId="+loadConfig.appId+"&"+S.param(loadConfig.params)+"&callback="+callback+"&"+loadt++;node.charset=loadConfig.charset||"gbk";var head=doc.getElementsByTagName("head")[0];setTimeout(function(){head.insertBefore(node,head.firstChild)},0)};ALD.render=function(root){var self=ALD;var DOM=S.DOM;S.each(DOM.query(".ald",root||document.body),function(el){if(DOM.data(el,"ald-inited")){return}DOM.data(el,"ald-inited",true);var appId=DOM.attr(el,"ald-appId");if(!appId){return}var config={render:el,appId:appId};parseJsonAttr(el,"ald-params",config,"params");parseJsonAttr(el,"ald-extra",config,"extra");self.load(config)})};S.ready(function(){ALD.render();S.each(ALD.queue,function(arr){ALD.load(arr[0],arr[1])});ALD.queue=[]})})(ALD,KISSY);